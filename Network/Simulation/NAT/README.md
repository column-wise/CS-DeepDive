# NAT란
NAT (Network Address Translation)
→ 사설 IP 주소와 공인 IP 주소를 변환해주는 네트워크 기술
- 사설망(Private Network) 내부의 컴퓨터들이 공인망(Public Internet)과 통신할 수 있도록 함
- 일반적으로 라우터나 방화벽 장비에 탑재되어 동작

### 왜 필요한가?
- IPv4 주소 부족 문제 해결
- 내부망 보안성 향상 (외부에서 직접 접근 불가)

# NAT의 장점
1. IPv4 주소 절약
    - 하나의 공인 IP로 여러 내부 장비가 인터넷 사용 가능
2. 보안성 향상
    - 사설 IP는 외부에서 직접 접근할 수 없어 기본적으로 보안 효과가 있음
3. 구성 유연성
    - 내부 IP 체계 변경 시 외부와의 연결에는 영향이 없음

# NAT의 단점
1. 연결 추적 필요
    - 매핑 테이블(사설↔공인)을 관리해야 하므로 자원이 소모됨
2. 일부 프로토콜과 충돌
    - FTP, VoIP, P2P 등은 NAT 환경에서 추가 설정 필요(ex. 포트 포워딩)
3. End-to-End 통신 제약
   클라이언트-클라이언트 구조의 직접 통신 어려움(P2P)

# NAT 동작과정
### 예시
- 내부 호스트: `10.0.0.1` (사용자 PC)
- NAT 라우터 (공유기):
    - 내부망 인터페이스: `10.0.0.254`
    - 외부망 인터페이스(WAN): `138.76.29.7`
- 외부 웹 서버: `128.119.40.186:80`
- 사용자가 웹 브라우저로 웹 서버에 접속하는 시나리오

1. 내부 호스트가 외부 서버에 요청을 보냄

| 항목 | 값 |
| --- | --- |
| 출발지 IP | `10.0.0.1` (내부 IP) |
| 출발지 포트 | `3345` (클라이언트 임의 포트) |
| 목적지 IP | `128.119.40.186` (웹 서버) |
| 목적지 포트 | `80` (HTTP) |

⇒ 이 패킷이 NAT 라우터로 전달됨

2. NAT 라우터가 패킷 변형 및 매핑 테이블 생성

라우터는
1. 출발지 IP를 공인 IP(138.76.29.7)로 변경
2. 출발지 포트를 5001로 변경(라우터가 사용되지 않은 포트 중 임의로 지정)
3. NAT 테이블에 아래 정보 저장

| WAN 포트 | 내부 IP | 내부 포트 |
| --- | --- | --- |
| 5001 | 10.0.0.1 | 3345 |

변형된 패킷:

| 항목 | 값 |
| --- | --- |
| 출발지 IP | `138.76.29.7` |
| 출발지 포트 | `5001` |
| 목적지 IP | `128.119.40.186` |
| 목적지 포트 | `80` |

⇒ 외부 서버로 전송됨

3. 외부 서버가 응답 전송

서버는 위 패킷에 대한 응답을 아래와 같이 보냄:

| 항목 | 값 |
| --- | --- |
| 출발지 IP | `128.119.40.186` |
| 출발지 포트 | `80` |
| 목적지 IP | `138.76.29.7` |
| 목적지 포트 | `5001` |

⇒ NAT 라우터가 받음

4. NAT 라우터가 응답 복원 및 내부로 전달

NAT 라우터는 목적지 포트 `5001`을 기준으로 NAT 테이블을 검색:
- 내부 IP: `10.0.0.1`
- 내부 포트: `3345`

⇒ 패킷을 다음과 같이 수정:

| 항목 | 값 |
| --- | --- |
| 출발지 IP | `128.119.40.186` |
| 출발지 포트 | `80` |
| 목적지 IP | `10.0.0.1` |
| 목적지 포트 | `3345` |

그리고 LAN으로 전달함
